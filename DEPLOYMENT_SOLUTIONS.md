# 部署解决方案 - 多种部署方法

## 问题分析
通过诊断发现：
- ✅ 服务器网络连接正常
- ✅ FTP 端口 21 开放，可以连接并查看目录
- ❌ SSH 端口 22 连接超时（可能被防火墙阻止）
- ❌ FTP 文件上传被拒绝（553错误，可能是权限或服务器配置问题）

## 解决方案

### 方案1: 使用 FTP 客户端手动上传（推荐）

#### 步骤：
1. **下载 FTP 客户端**（如 FileZilla、Cyberduck 等）
2. **连接服务器**：
   - 主机：`wh-ns2qk7g9bluizy0ffx2.my3w.com`
   - 端口：`21`
   - 用户名：`wh-ns2qk7g9bluizy0ffx2`
   - 密码：`dadao123456#`

3. **上传文件**：
   - 将 `deploy-package-ftp/` 目录下的所有文件上传到服务器
   - 或者上传 `deploy-package.tar.gz` 压缩包

4. **服务器端部署**：
   - 通过阿里云控制台 VNC 登录服务器
   - 执行：`tar -xzf deploy-package.tar.gz && chmod +x deploy-server.sh && ./deploy-server.sh`

### 方案2: 通过阿里云控制台文件管理

1. **登录阿里云控制台**
2. **找到您的服务器实例**
3. **使用文件管理功能**上传部署文件
4. **通过 VNC 执行部署脚本**

### 方案3: 联系服务商解决权限问题

联系阿里云技术支持，请求：
- 开放 SSH 端口 22
- 检查 FTP 上传权限设置
- 确认服务器配置

## 当前可用的文件

### 部署包位置：
- `deploy-package-ftp/` - 完整的部署文件目录
- `deploy-package.tar.gz` - 压缩包版本（运行脚本后生成）

### 部署脚本：
- `deploy-server.sh` - 服务器端部署脚本
- `server-unpack.sh` - 文件解压脚本

## 服务器端部署步骤

### 1. 上传文件到服务器
使用上述任一方法将文件上传到服务器。

### 2. 登录服务器
通过阿里云控制台的 VNC 功能登录服务器。

### 3. 执行部署
```bash
# 如果上传的是压缩包
tar -xzf deploy-package.tar.gz
chmod +x deploy-server.sh
./deploy-server.sh

# 如果上传的是目录
cd deploy-package-ftp
chmod +x deploy-server.sh
./deploy-server.sh
```

### 4. 验证部署
- 访问：`http://服务器IP:3000`
- 检查 PM2 状态：`pm2 status`
- 查看日志：`pm2 logs`

## 故障排除

### 如果部署失败：
1. **检查 Node.js**：`node --version`（需要 Node.js 18+）
2. **检查端口**：确保 3000 端口在安全组中开放
3. **查看错误日志**：`pm2 logs nextjs-app`

### 如果无法连接服务器：
1. **检查安全组**：在阿里云控制台确认端口开放
2. **重启服务**：`systemctl restart sshd`（如果 SSH 可用）
3. **联系技术支持**：阿里云客服

## 重要提示

1. **备份重要数据**：部署前确保重要文件已备份
2. **记录部署过程**：记录每一步操作，便于排查问题
3. **测试访问**：部署完成后立即测试网站访问
4. **监控运行状态**：定期检查应用运行状态

## 联系方式
- 阿里云技术支持：400-801-8080
- 服务器提供商：检查您的服务合同

---

**注意**：由于服务器配置限制，自动化部署可能无法完全实现。建议优先使用方案1（FTP客户端手动上传）配合VNC登录进行部署。